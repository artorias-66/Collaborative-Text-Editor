# üöÄ Deploying to Render

This guide will help you deploy your Collaborative Text Editor to Render with automated deployment using the `render.yaml` blueprint.

## Prerequisites

Before deploying, ensure you have:

1. ‚úÖ A [Render account](https://render.com) (free tier available)
2. ‚úÖ A [MongoDB Atlas](https://www.mongodb.com/cloud/atlas) account with a cluster created
3. ‚úÖ A [Google Gemini API key](https://makersuite.google.com/app/apikey)
4. ‚úÖ Your code pushed to GitHub (Render will pull from your repository)

---

## Step 1: Prepare MongoDB Atlas

1. Go to [MongoDB Atlas](https://cloud.mongodb.com)
2. Create a free cluster (if you haven't already)
3. Go to **Database Access** ‚Üí Create a database user with password
4. Go to **Network Access** ‚Üí Add IP Address ‚Üí **Allow Access from Anywhere** (0.0.0.0/0)
5. Click **Connect** ‚Üí **Connect your application**
6. Copy your connection string (looks like):
   ```
   mongodb+srv://username:<password>@cluster0.xxxxx.mongodb.net/collaborative-editor?retryWrites=true&w=majority
   ```
7. Replace `<password>` with your actual database user password

---

## Step 2: Push Code to GitHub

Make sure your code is in a GitHub repository:

```bash
git add .
git commit -m "Prepare for Render deployment"
git push origin main
```

---

## Step 3: Deploy on Render

### Option A: Using Render Blueprint (Recommended - Automated)

1. Go to [Render Dashboard](https://dashboard.render.com/)
2. Click **New** ‚Üí **Blueprint**
3. Connect your GitHub repository
4. Render will detect `render.yaml` and show 2 services:
   - `collaborative-editor-api` (Backend)
   - `collaborative-editor-frontend` (Frontend)

5. **Configure Environment Variables** for Backend (`collaborative-editor-api`):
   
   | Variable | Value |
   |----------|-------|
   | `MONGODB_URI` | Your MongoDB Atlas connection string |
   | `JWT_SECRET` | Auto-generated by Render |
   | `GEMINI_API_KEY` | Your Google Gemini API key |
   | `CLIENT_URL` | `https://collaborative-editor-frontend.onrender.com` (update after frontend deploys) |

6. **Configure Environment Variables** for Frontend (`collaborative-editor-frontend`):
   
   | Variable | Value |
   |----------|-------|
   | `REACT_APP_API_URL` | `https://collaborative-editor-api.onrender.com/api` |
   | `REACT_APP_SOCKET_URL` | `https://collaborative-editor-api.onrender.com` |

7. Click **Apply** to start deployment

---

### Option B: Manual Deployment

#### Deploy Backend:

1. Click **New** ‚Üí **Web Service**
2. Connect your GitHub repository
3. Configure:
   - **Name**: `collaborative-editor-api`
   - **Runtime**: `Node`
   - **Build Command**: `cd server && npm install`
   - **Start Command**: `cd server && npm start`
   - **Plan**: Free
4. Add environment variables (same as above)
5. Click **Create Web Service**

#### Deploy Frontend:

1. Click **New** ‚Üí **Static Site**
2. Connect your GitHub repository
3. Configure:
   - **Name**: `collaborative-editor-frontend`
   - **Build Command**: `cd client && npm install && npm run build`
   - **Publish Directory**: `client/build`
4. Add environment variables (same as above)
5. Click **Create Static Site**

---

## Step 4: Update Environment Variables

After both services are deployed:

1. **Copy your backend URL** (e.g., `https://collaborative-editor-api.onrender.com`)
2. **Update Backend Environment Variables**:
   - Go to backend service ‚Üí Environment
   - Update `CLIENT_URL` to your frontend URL
   - Save changes (triggers auto-redeploy)

3. **Copy your frontend URL** (e.g., `https://collaborative-editor-frontend.onrender.com`)
4. **Update Frontend Environment Variables**:
   - Go to frontend service ‚Üí Environment
   - Verify `REACT_APP_API_URL` and `REACT_APP_SOCKET_URL` point to backend URL
   - Save changes (triggers auto-redeploy)

---

## Step 5: Verify Deployment

1. **Check Backend Health**:
   - Visit: `https://your-backend-url.onrender.com/health`
   - Should see: `{"status":"ok","timestamp":"...","environment":"production"}`

2. **Open Frontend**:
   - Visit: `https://your-frontend-url.onrender.com`
   - Test login/register functionality
   - Create a document
   - Test AI features

---

## Important Notes

### Free Tier Limitations:
- ‚ö†Ô∏è **Free services spin down after 15 minutes of inactivity**
- First request after inactivity may take 30-60 seconds to wake up
- Consider upgrading to paid plan for production use

### Custom Domain (Optional):
1. Go to your service ‚Üí Settings ‚Üí Custom Domain
2. Add your domain and configure DNS records
3. Render provides free SSL certificates

### Automatic Deployments:
- Render automatically redeploys when you push to your main branch
- Check deployment logs in the Render dashboard

---

## Troubleshooting

### Backend won't start:
- Check environment variables are set correctly
- Verify MongoDB connection string (IP whitelist, password)
- Check logs: Dashboard ‚Üí Service ‚Üí Logs

### Frontend can't connect to backend:
- Verify CORS settings in `server/index.js`
- Ensure `CLIENT_URL` in backend matches frontend URL exactly
- Check browser console for errors

### Database connection fails:
- Verify MongoDB Atlas IP whitelist includes `0.0.0.0/0`
- Check username and password in connection string
- Test connection string locally first

### WebSocket connection issues:
- Ensure `REACT_APP_SOCKET_URL` doesn't have `/api` suffix
- Check browser console for Socket.io errors
- Verify backend CORS configuration

---

## Environment Variables Reference

### Backend (.env)
```env
NODE_ENV=production
PORT=10000
MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/dbname
JWT_SECRET=your-generated-secret
GEMINI_API_KEY=your-gemini-api-key
CLIENT_URL=https://your-frontend-url.onrender.com
```

### Frontend (.env)
```env
REACT_APP_API_URL=https://your-backend-url.onrender.com/api
REACT_APP_SOCKET_URL=https://your-backend-url.onrender.com
```

---

## Monitoring and Logs

- **View Logs**: Dashboard ‚Üí Service ‚Üí Logs
- **Metrics**: Dashboard ‚Üí Service ‚Üí Metrics (paid plans)
- **Events**: Dashboard ‚Üí Service ‚Üí Events

---

## Upgrading from Free Tier

To avoid spin-down and get better performance:

1. Go to Service ‚Üí Settings ‚Üí Plan
2. Choose **Starter** ($7/month per service)
3. Benefits:
   - No spin-down
   - 512 MB RAM
   - Better performance
   - Custom domains with SSL

---

## Next Steps

‚úÖ Your app is now live!
- Share the frontend URL with users
- Monitor logs for errors
- Set up MongoDB backups
- Consider upgrading for production use

For support: [Render Documentation](https://render.com/docs)
